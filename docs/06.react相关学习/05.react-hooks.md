---
title: 05.react-hooks
sidebar: auto
date: 2021-08-08 00:00:00
tags:
  - react-hooks
categories:
  - reactç›¸å…³å­¦ä¹ 
---

<!-- more -->

## 1.useState

å¯ä»¥ä½¿æ— çŠ¶æ€ç»„ä»¶å¯ä»¥ä½¿ç”¨çŠ¶æ€æ•°æ®ï¼Œå³åœ¨ä¸æ˜¯ class ç±»ç»„ä»¶çš„ç»„ä»¶ä¸­ä¹Ÿå¯ä»¥å®ç°ç±»ä¼¼ state={}çš„çŠ¶æ€æ•°æ®ç®¡ç†

```js
//åœ¨ç±»ç»„ä»¶ä¸­
class Page extends React.Compenent {
  state = {
    text: "æˆ‘æ˜¯çŠ¶æ€æ•°æ®",
  };
}
{
  this.state.text;
} //æˆ‘æ˜¯çŠ¶æ€æ•°æ®
//åœ¨å‡½æ•°ç»„ä»¶ä¸­
import { useState } from "react";
function Page() {
  //å•çŠ¶æ€æ•°æ®
  var [val, setVal] = useState(0);
  return (
    <>
      <div>{val}</div> {/*0*/}
      <div onClick={() => setVal(val + 1)}>{val}</div>
      {/*ç‚¹å‡»ä¹‹åä¸º0+1*/}
    </>
  );

  //å¤šçŠ¶æ€æ•°æ®
  var [val, setVal] = useState({ name: "ljm", age: 21 });
  return (
    <>
      <div>
        {val.name}:{val.age}
      </div>
      {/*ljm:21*/}
      <div onClick={() => setVal({ name: "yyx", age: 22 })}>
        {val.name}:{val.age}
      </div>
      {/*ç‚¹å‡»ä¹‹åä¸ºyyx:22*/}
    </>
  );
}
```

## 2.useEffect

### **è¦ç‚¹ä¸€**:ç»™å‡½æ•°ç»„ä»¶å¢åŠ ç”Ÿå‘½å‘¨æœŸ,ç›¸å½“äºç”Ÿå‘½å‘¨æœŸçš„`componentDidMount` å’Œ `componentDidUpdate`

```js
import { useState,useEffect} from "react";
function Page(){
   var [val, setVal] = useState({ age: 21 });
     // ç›¸å½“äº ç”Ÿå‘½å‘¨æœŸçš„componentDidMount å’Œ componentDidUpdate:
  useEffect(()=>{
      console.log(val.age) //ä¼šè§¦å‘2æ¬¡,ç¬¬ä¸€æ¬¡å€¼ä¸º21 (componentDidMountç»„ä»¶æŒ‚è½½çš„æ—¶å€™ä¼šè§¦å‘ä¸€æ¬¡) ç¬¬äºŒæ¬¡å€¼ä¸º22(componentDidUpdateç»„ä»¶æŒ‚è½½çš„æ—¶å€™ä¼šè§¦å‘ä¸€æ¬¡)
  })
  return (<div onClick={()=>setVal({age:22})}>{val.age}}>)
}
```

### **è¦ç‚¹äºŒ**:åœ¨ useEffect ä¸­ retrun ä¸€ä¸ªå‡½æ•°ç›¸å½“äºç”Ÿå‘½å‘¨æœŸçš„`componentWillUnmount`

```js
function About() {
  // ç›¸å½“äº ç”Ÿå‘½å‘¨æœŸçš„componentDidMount å’Œ componentDidUpdate:
  useEffect(() => {
    console.log("1"); //è¿›å…¥é¡µé¢çš„æ—¶å€™æ‰“å°1
    //returnä¸€ä¸ªå‡½æ•°ç›¸å½“äºclassç±»å‡½æ•°ä¸­çš„componentWillUnmountç”Ÿå‘½å‘¨æœŸ
    return function Clean() {
      console.log("2"); //åœ¨ç¦»å¼€é¡µé¢çš„æ—¶å€™ä¼šæ‰“å°2
    };
  });
}
```

**_ä¸ºä»€ä¹ˆè¦åœ¨ effect ä¸­è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Ÿ_** è¿™æ˜¯ effect å¯é€‰çš„æ¸…é™¤æœºåˆ¶ã€‚æ¯ä¸ª effect éƒ½å¯ä»¥è¿”å›ä¸€ä¸ªæ¸…é™¤å‡½æ•°ã€‚å¦‚æ­¤å¯ä»¥å°†æ·»åŠ å’Œç§»é™¤è®¢é˜…çš„é€»è¾‘æ”¾åœ¨ä¸€èµ·ã€‚å®ƒä»¬éƒ½å±äº effect çš„ä¸€éƒ¨åˆ†ã€‚

### **è¦ç‚¹ä¸‰**:useEffect ä¸­çš„ç”Ÿå‘½å‘¨æœŸ`componentDidUpdate`å€¼ç›¸åŒä¸é‡æ–°æ¸²æŸ“ï¼Œå®ç°æ€§èƒ½ä¼˜åŒ–

åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ›´æ–°çš„å€¼ä¸åŸå€¼ç›¸åŒæ—¶å€™ä¹Ÿä¼šæ‰§è¡Œ useEffect,åœ¨ `class` ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨ `componentDidUpdate` ä¸­æ·»åŠ å¯¹ `prevProps` æˆ– `prevState` çš„æ¯”è¾ƒé€»è¾‘è§£å†³ï¼š

```js
componentDidUpdate(prevProps, prevState) {
  //å¦‚æœæ–°å€¼ä¸ç­‰äºæ—§å€¼æ‰ä¼šæ‰§è¡Œ
  if (prevState.count !== this.state.count) {
    document.title = `You clicked ${this.state.count} times`;
  }
}
```

åœ¨ useEffect å‡½æ•°ä¸­,ç¬¬ä¸€ä¸ªå‚æ•°æ²¡æ‰§è¡Œå‡½æ•°ï¼Œ`ç¬¬äºŒä¸ªå‚æ•°`ä¸ºæ¯”è¾ƒæ—§å€¼åˆ¤æ–­æ‰§è¡Œä¸æ‰§è¡Œ `ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªæ•°ç»„`

```js
//ç›¸å½“äºvueçš„watch
function About() {
  var [val, setVal] = useState({ name: "yyx", age: 21 });
  // ç›¸å½“äº ç”Ÿå‘½å‘¨æœŸçš„componentDidMount å’Œ componentDidUpdate:
  useEffect(() => {
    console.log(val.age); //21 22 23 24...ç›‘å¬val.ageçš„å˜åŒ–
  }, [val.age]);
  useEffect(() => {
    console.log(val.name); //é™¤äº†åˆå§‹æ¸²æŸ“,ç‚¹å‡»äº‹ä»¶ä¸è§¦å‘
  }, [val.name]);
  return (
    <div onClick={() => setVal({ name: "yyx", age: val.age + 1 })}>
      {val.name}:{val.age}
    </div>
  );
}
//å¦‚æœå†™åœ¨ä¸€èµ·
useEffect(() => {
  console.log(val.age); //yyx yyx yyx
  console.log(val.name); // 21  22  23
}, [val.age, val.name]); //ä¹Ÿå°±æ˜¯åªè¦ä¸€ä¸ªå€¼å‘ç”Ÿæ”¹å˜æ‰€æœ‰çš„å€¼éƒ½ä¼šé‡æ–°è®¡ç®—
```

***æ³¨æ„***
:::tip
**è¿™é‡Œé‡ç‚¹è¯´ä¸€ä¸‹useEffectçš„ç¬¬äºŒä¸ªå‚æ•°**</br>
ä¸€ã€ç¬¬äºŒä¸ªå‚æ•°å­˜æ”¾å˜é‡ï¼Œå½“æ•°ç»„å­˜æ”¾å˜é‡å‘ç”Ÿæ”¹å˜æ—¶ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ï¼Œé€»è¾‘å¤„ç†å‡½æ•°å°†ä¼šè¢«æ‰§è¡Œ</br>
äºŒã€ç¬¬äºŒä¸ªå‚æ•°å¯ä»¥ä¸ä¼ ï¼Œä¸ä¼šæŠ¥é”™ï¼Œä½†æµè§ˆå™¨ä¼šæ— çº¿å¾ªç¯æ‰§è¡Œé€»è¾‘å¤„ç†å‡½æ•°ã€‚</br>
```js
useEffect(() => {
/** æ‰§è¡Œé€»è¾‘ */
})
```

ä¸‰ã€ç¬¬äºŒä¸ªå‚æ•°å¦‚æœåªä¼ ä¸€ä¸ªç©ºæ•°ç»„ï¼Œé€»è¾‘å¤„ç†å‡½æ•°é‡Œé¢çš„é€»è¾‘åªä¼šåœ¨ç»„ä»¶æŒ‚è½½æ—¶æ‰§è¡Œä¸€æ¬¡ ï¼Œä¸å°±æ˜¯ç›¸å½“äº componentDidMount.</br>
```js
useEffect(() => {
/** æ‰§è¡Œé€»è¾‘ */
},[])
```

å››ã€ç¬¬äºŒä¸ªå‚æ•°å¦‚æœä¸ä¸ºç©ºæ•°ç»„ï¼Œå¦‚ä¸‹
```js
const [a, setA] = useState(1);
const [b, setB] = useState(2);
useEffect(() => {
/** æ‰§è¡Œé€»è¾‘ */
},[a,b])
```
:::






## 3.memo(çˆ¶ç»„ä»¶æ”¹å˜æ—¶å€™ï¼Œå¦‚æœä½¿ç”¨memoçš„å­ç»„ä»¶å†…å®¹ä¸æ”¹å˜åˆ™ä¸æ¸²æŸ“)

### å‡½æ•°ç»„ä»¶ä½¿ç”¨ memo,ç±»ç”¨ shouldComponentUpdate

å­ç»„ä»¶ä¼šåœ¨çˆ¶ç»„ä»¶ä¿®æ”¹ state åé‡æ–°æ¸²æŸ“(class ç±»ç»„ä»¶ä¿®æ”¹ state,å‡½æ•°ç»„ä»¶ä¿®æ”¹ useState),ä¸ºäº†ä¼˜åŒ–æ€§èƒ½ï¼Œåœ¨å­ç»„ä»¶æ•°æ®ä¸æ›´æ–°çš„æƒ…å†µä¸‹ä¸é‡æ–°æ¸²æŸ“æ‰ä½¿ç”¨ memo,å¯ä»¥å®ç°æ€§èƒ½ä¼˜åŒ–

- ç›¸å½“äºç±»ç»„ä»¶ç”Ÿå‘½å‘¨æœŸå‡½æ•°ä¸­çš„`shouldComponentUpdate`:åˆ¤æ–­æ˜¯å¦æ›´æ–°äº†ç»„ä»¶çš„æ•°æ®æ¥è§‰å¾—æ˜¯å¦é‡æ–°æ¸²æŸ“ç»„ä»¶
- `memo`åªèƒ½ç”¨äºå‡½æ•°ç»„ä»¶ï¼Œ`shouldComponentUpdate`åªèƒ½ç”¨äº class ç±»ç»„ä»¶

1. ä¸ä½¿ç”¨ memo å’Œ shouldComponentUpdate:æ¯å½“ç‚¹å‡»`{this.state.val}`çš„æ—¶å€™éƒ½ä¼šå†æ¬¡æ‰“å° A å’Œ B,é‡æ–°æ¸²æŸ“äº†å­ç»„ä»¶

```js
//father.js
class Father extends React.Component {
  state = {
    val: 1,
  };
  render() {
    return (
      <div>
        <A a={"about-a"} />
        <B />
        <p onClick={() => this.setState({ val: this.state.val + 1 })}>
          {this.state.val}
        </p>
      </div>
    );
  }
}
//A.js
const A = (props) => {
  console.log("A");
  return <div>{props.a}</div>;
};
//B.js
class B extends React.Component {
  render() {
    return <div>B{console.log("B")}</div>;
  }
}
```

2. ä½¿ç”¨ memo(å‡½æ•°ç»„ä»¶),ç±»ç»„ä»¶ä½¿ç”¨`shouldComponentUpdate`,çˆ¶ç»„ä»¶æ›´æ–°æ•°æ®ä¸ä¼šé‡æ–°æ¸²æŸ“å­ç»„ä»¶

```js
//father.js
class Father extends React.Component{
  state={
    val:1
  }
  render(){
      return (
    <div>
      <A a={'about-a'}/><B /><p onClick={()=>this.setState({val:this.state.val+1})}>{this.state.val}</p>
    </div>
  );
  }
}
//A.js
import {memo} from 'react'
const A =memoï¼ˆ(props)=>{
   console.log('A')
   return <div>{props.a}</div>
}ï¼‰
//B.js
 class B extends React.Component{
        //nextPropsæ˜¯ä¸‹æ¬¡æ¸²æŸ“ç”¨åˆ°çš„props
  shouldComponentUpdate(nextProps, nextState) {
    //å°†ä¸‹æ¬¡æ¸²æŸ“ç”¨åˆ°çš„propså’Œå½“å‰propså¯¹æ¯”
    if (nextProps.name === this.props.name) {
      return false;//è¿”å›falseåˆ™å½“å‰ç»„ä»¶ä¸ä¼šè¢«é‡æ–°æ¸²æŸ“
    }
    return true;//è¿”å›trueåˆ™å½“å‰ç»„ä»¶éœ€è¦è¢«é‡æ–°æ¸²æŸ“
  }
     render(){
        return <div>B{console.log('B')}</div>
     }
 }
```

## 4.memo,useMemo å’Œ useCallback  (ğŸŒŸè¿˜ä¸æ˜¯å¤ªæ˜ç™½åŒºåˆ«ï¼Œéœ€è¦å·©å›º)
### memoå’ŒuseMemo (memoæµ…å±‚ï¼ŒuseMemoæ·±å±‚)
`memo`ç”¨æ¥ä¼˜åŒ–å‡½æ•°ç»„ä»¶çš„é‡å¤æ¸²æŸ“è¡Œä¸ºï¼Œå½“ä¼ å…¥å±æ€§å€¼éƒ½ä¸å˜çš„æƒ…å†µä¸‹ä¸ä¼šè§¦å‘ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ï¼Œå¦åˆ™å°±ä¼šè§¦å‘ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ï¼›å’Œç±»ç»„ä»¶çš„PureComponentçš„åŠŸèƒ½æ˜¯ç±»ä¼¼çš„ï¼›åœ¨hooksç¯å¢ƒä¸‹ï¼Œå‡ ä¹æ‰€æœ‰ç»„ä»¶éƒ½æ˜¯å‡½æ•°å¼ç»„ä»¶ï¼Œæˆ‘ä»¬ä½¿ç”¨memoçš„å‡ ç‡è¦æ¯”PureComponenté«˜å¾—å¤šï¼›</br>
- `memo`é’ˆå¯¹çš„æ˜¯ä¸€ä¸ªç»„ä»¶çš„æ¸²æŸ“æ˜¯å¦é‡å¤æ‰§è¡Œ
- `useMemo`åˆ™å®šä¹‰äº†ä¸€æ®µå‡½æ•°é€»è¾‘æ˜¯å¦é‡å¤æ‰§è¡Œ </br>
æœ¬è´¨éƒ½æ˜¯ç”¨åŒæ ·çš„ç®—æ³•æ¥åˆ¤å®šä¾èµ–æ˜¯å¦å‘ç”Ÿæ”¹å˜ï¼Œç»§è€Œå†³å®šæ˜¯å¦è§¦å‘ç‰¹å®šé€»è¾‘ï¼›ï¼ˆæœ‰å¾ˆå¤šè¿™æ ·çš„é€»è¾‘ï¼šè¾“å…¥å’Œè¾“å‡ºæ˜¯å¯¹ç­‰çš„ï¼Œç›¸åŒçš„è¾“å…¥ä¸€å®šäº§ç”Ÿç›¸åŒçš„è¾“å‡ºï¼Œæ•°å­¦ä¸Šç§°ä¹‹ä¸ºå¹‚ç­‰ï¼‰åˆ©ç”¨memoå°±å¯ä»¥é¿å…ä¸å¿…è¦çš„é‡å¤è®¡ç®—ï¼Œå‡å°‘èµ„æºæµªè´¹ã€‚(ä¸ä½¿ç”¨memoå’ŒuseMemoä¸åº”è¯¥ä¼šå¯¼è‡´ä½ çš„ä¸šåŠ¡é€»è¾‘å‘ç”Ÿå˜,memoå’ŒuseMemoåªæ˜¯ç”¨æ¥åšæ€§èƒ½ä¼˜åŒ–ï¼‰â€‹
----------
### useMemoå’ŒuseEffect
`useMemo`å’Œ`useEffect`çš„è¯­æ³•æ˜¯ä¸€æ ·çš„ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¦æ‰§è¡Œçš„é€»è¾‘å‡½æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯è¿™ä¸ªé€»è¾‘å‡½æ•°ä¾èµ–çš„å˜é‡ç»„æˆçš„æ•°ç»„ï¼Œå¦‚æœä¸ä¼ ç¬¬äºŒä¸ªå‚æ•°ï¼Œåˆ™useMemoçš„é€»è¾‘å‡½æ•°æ¯æ¬¡éƒ½æ‰§è¡Œï¼Œé‚£useMemoçš„æ„ä¹‰å°±ä¸å­˜åœ¨äº†ã€‚**å¦‚æœä¼ å…¥ç©ºæ•°ç»„ï¼Œåˆ™åªæ‰§è¡Œä¸€æ¬¡**ï¼›</br>
`useMemo`å’Œ`useEffect`çš„æ‰§è¡Œæ—¶æœºæ˜¯ä¸ä¸€è‡´çš„ï¼š`useEffect`æ‰§è¡Œçš„æ˜¯å‰¯ä½œç”¨ï¼Œæ‰€ä»¥ä¸€å®šæ˜¯åœ¨æ¸²æŸ“ä¹‹åæ‰§è¡Œçš„ï¼Œ`useMemo`æ˜¯éœ€è¦æœ‰è¿”å›å€¼çš„ï¼Œè€Œè¿”å›å€¼å¯ä»¥ç›´æ¥å‚ä¸æ¸²æŸ“çš„ï¼Œæ‰€ä»¥useMemoæ˜¯åœ¨æ¸²æŸ“æœŸé—´å®Œæˆçš„ï¼Œæœ‰è¿™æ ·ä¸€ä¸ªä¸€å‰ä¸€åçš„åŒºåˆ«

### useMemoå’ŒuseCallback
userMemoå’ŒuseCallbackæ¥å—çš„å‚æ•°éƒ½æ˜¯ä¸€æ ·çš„ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºå›è°ƒå‡½æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯è¦ä¾èµ–çš„æ•°æ®ï¼›
- ***å…±åŒç‚¹***ï¼šåªæœ‰åœ¨ä¾èµ–æ•°æ®å‘ç”Ÿå˜åŒ–åï¼Œæ‰ä¼šé‡æ–°è®¡ç®—ç»“æœï¼Œèµ·åˆ°ç¼“å­˜çš„ä½œç”¨

- ***åŒºåˆ«***ï¼šuseMemoè¿”å›çš„æ˜¯è®¡ç®—çš„ç»“æœå€¼ï¼Œç”¨äºç¼“å­˜è®¡ç®—åçš„çŠ¶æ€useCallbackè¿”å›çš„æ˜¯å‡½æ•°ï¼Œä¸»è¦ç”¨æ¥ç¼“å­˜å‡½æ•°ï¼Œå› ä¸ºå‡½æ•°å¼ç»„ä»¶ä¸­çš„stateçš„å˜åŒ–éƒ½ä¼šå¯¼è‡´æ•´ä¸ªç»„ä»¶è¢«é‡æ–°åˆ·æ–°ï¼ˆå³ä½¿ä¸€äº›å‡½æ•°æ²¡æœ‰å¿…è¦è¢«åˆ·æ–°ï¼‰ï¼Œæ­¤æ—¶ç”¨useCallbackå°±ä¼šå°†å‡½æ•°è¿›è¡Œç¼“å­˜ï¼Œå‡å°‘æ¸²æŸ“æ—¶çš„æ€§èƒ½æŸè€—â€‹


## useRefå’ŒforwardRef
### å‡½æ•°ç»„ä»¶ä¸­åˆ›å»ºref
ç­‰åŒäº vue çš„ ref,ç±»ç»„ä»¶åªéœ€è¦`useRef`ï¼Œå‡½æ•°ç»„ä»¶éœ€è¦`useRef`å’Œ`forwardRef`é…åˆä½¿ç”¨

```js
import { useRef } from "react";
//åªç”¨äºå‡½æ•°ç»„ä»¶,ä½¿ç”¨hooks-useRefåˆ›å»ºref
const firstEl = useRef();
//æ”¾äºæ ‡ç­¾
<p ref={firstEl}>
  {'a'}
</p>; //console.log(firstEl.current.textContent) //'a'

//1.æ”¾äºç»„ä»¶ï¼ŒğŸ”´ ä»…ç”¨äºç±»ç»„ä»¶
<B b={b} add={()=>setB(b+1)}  ref={firstEl}/> //å¯ä»¥è·å–ç»„ä»¶çš„props,å®šä¹‰çš„æ–¹æ³•ï¼Œstateç­‰

//2.æ”¾äºç»„ä»¶.ğŸ”´ ç”¨äºå‡½æ•°ç»„ä»¶ï¼Œå¾—åœ¨å­ç»„ä»¶ä¸­ä½¿ç”¨forwardRef
<A a={a} ref={firstEl}/>
//a.js
import {memo,forwardRef} from 'react'
const A =memo(forwardRef((props,_ref)=>{
   return <div ref={_ref}>{props.a}</div>
}))
export default A  //åœ¨çˆ¶ç»„ä»¶ä¸­ä½¿ç”¨firstElå¯ä»¥è·å–a.jsä¸­divçš„å€¼props.a
```

### classç±»ç»„ä»¶ä¸­åˆ›å»ºref
```js
class extends React.Compenent{
  state={
    firstEl:React.createRef() //ä½¿ç”¨reactåˆ›å»ºref
  }
   render() {
      return (
        <div>
          <h1>ç§»åŠ¨é¼ æ ‡!</h1>
          {/*ä½¿ç”¨ref*/}
          <MouseWithCat  ref={this.state.firstEl}/>
        </div>
      );
    }
}
```





## **hook è§„åˆ™**

- ä¸è¦åœ¨å¾ªç¯ï¼Œæ¡ä»¶æˆ–åµŒå¥—å‡½æ•°ä¸­è°ƒç”¨ Hookï¼Œ ç¡®ä¿æ€»æ˜¯åœ¨ä½ çš„ React å‡½æ•°çš„æœ€é¡¶å±‚è°ƒç”¨ä»–ä»¬ã€‚

```js
// ğŸ”´ åœ¨æ¡ä»¶è¯­å¥ä¸­ä½¿ç”¨ Hook è¿åç¬¬ä¸€æ¡è§„åˆ™,ä¸èƒ½åœ¨æ¡ä»¶å‡½æ•°ä¸­è°ƒç”¨hook
if (name !== "") {
  useEffect(function persistForm() {
    localStorage.setItem("formData", name);
  });
}

//å¯ä»¥å°†æ¡ä»¶è¯­å¥æ”¾åœ¨hookå†…éƒ¨
useEffect(function persistForm() {
  // ğŸ‘ å°†æ¡ä»¶åˆ¤æ–­æ”¾ç½®åœ¨ effect ä¸­
  if (name !== "") {
    localStorage.setItem("formData", name);
  }
});
```

- åœ¨ React çš„å‡½æ•°ç»„ä»¶ä¸­è°ƒç”¨ Hook
