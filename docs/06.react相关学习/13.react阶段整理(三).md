---
title: 13.reacté˜¶æ®µæ•´ç†(ä¸‰)(ç³»ç»Ÿæ•´ç†)
sidebar: auto
date: 2021-09-01 00:00:00
tags:
  - reacté˜¶æ®µæ•´ç†(ä¸‰)
categories:
  - reactç›¸å…³å­¦ä¹ 
---

<!-- more -->

:::tip
å¤ä¹ åå‘ç°
:::

## 1.æ–°æ—§ç”Ÿå‘½å‘¨æœŸå·©å›º

### 1.æ—§ç”Ÿå‘½å‘¨æœŸ

![æ—§ç”Ÿå‘½å‘¨æœŸ.png](<http://47.99.154.206:8010/reactç”Ÿå‘½å‘¨æœŸ/reactç”Ÿå‘½å‘¨æœŸ(æ—§).png>)

- **ä¸€.åˆå§‹åŒ–é˜¶æ®µ** :ç”± ReactDOM.render()è§¦å‘---åˆæ¬¡æ¸²æŸ“

  - 1.constructor()
  - 2.componentWillMount()
  - 3.render()
  - 4.componentDidMount() =====> å¸¸ç”¨(ä¸€èˆ¬åœ¨è¿™ä¸ªé’©å­ä¸­åšä¸€äº›åˆå§‹åŒ–çš„äº‹ï¼Œä¾‹å¦‚ï¼šå¼€å¯å®šæ—¶å™¨ã€å‘é€ç½‘ç»œè¯·æ±‚ã€è®¢é˜…æ¶ˆæ¯)

- **äºŒ.æ›´æ–°é˜¶æ®µ** :ç”±ç»„ä»¶å†…éƒ¨ this.setSate()æˆ–çˆ¶ç»„ä»¶ render è§¦å‘

  - 1.shouldComponentUpdate()
  - 2.componentWillUpdate()
  - 3.render() =====> å¸¸ç”¨,å¿…é¡»ä½¿ç”¨çš„ä¸€ä¸ª
  - 4.componentDidUpdate()

- **ä¸‰.å¸è½½ç»„ä»¶** :ç”± ReactDOM.unmountComponentAtNode()è§¦å‘

  - 1.componentWillUnmount() =====> å¸¸ç”¨(ä¸€èˆ¬åœ¨è¿™ä¸ªé’©å­ä¸­åšä¸€äº›æ”¶å°¾çš„äº‹ï¼Œä¾‹å¦‚ï¼šå…³é—­å®šæ—¶å™¨ã€å–æ¶ˆè®¢é˜…æ¶ˆæ¯)

```js
ä¸‰ç§ç”Ÿå‘½å‘¨æœŸæ‰§è¡Œæ‰€éœ€ç”Ÿå‘½å‘¨æœŸå‡½æ•°,å¦‚å›¾æ‰€ç¤º
//1.é¡µé¢æ‰§è¡Œ
constructor--->componentWillMount--->render--->componentDidMount
//2.é¡µé¢æ›´æ–°
setState--->shouldComponentUpdate--->componentWillUpdate--->render--->componentDidUpdate
//3.æœ‰ç»„ä»¶çš„é¡µé¢æ›´æ–°ï¼Œçˆ¶ç»„ä»¶æ›´æ–°å¯¼è‡´å¯¹åº”å­ç»„ä»¶æ›´æ–°
componentWillReceiveProps--->shouldComponentUpdate--->componentWillUpdate--->render--->componentDidUpdate
//ğŸŒŸæç¤º:componentWillReceivePropsç»„ä»¶å°†è¦æ¥æ”¶æ–°çš„propsçš„é’©å­ï¼Œç¬¬ä¸€æ¬¡æ¸²æŸ“ä¸æ‰§è¡Œï¼Œæ‰€ä»¥åˆå¯ä»¥å«componentWillReceiveNewProps
```

:::tip
è¿™é‡Œæä¸€ä¸‹å‡ ä¸ªé’©å­çš„å‚æ•°

```js
//ç»„ä»¶å°†è¦æ¥æ”¶æ–°çš„propsçš„é’©å­ï¼Œç¬¬ä¸€æ¬¡æ¸²æŸ“ä¸æ‰§è¡Œ,å¯ä»¥æ¥æ”¶newProps
			componentWillReceiveProps(newProps) {
				console.log('componentWillReceiveProps', newProps);
			}
//æ§åˆ¶ç»„ä»¶æ›´æ–°çš„â€œé˜€é—¨â€  å¯ä»¥æ¥æ”¶æ–°çš„propså’Œæ–°çš„state
			shouldComponentUpdate(nextProps, nextState) {
				console.log('shouldComponentUpdate');
				//å¯ä»¥æ ¹æ®æ–°æ—§propså€¼æ¥æ§åˆ¶æ›´æ–°
				console.log(this.props, nextProps)
				//æ–°æ—§ä¸€ä¸ªå±æ€§å€¼ç›¸ç­‰å°±ä¸æ›´æ–°äº†ï¼Œä¸å¯ä»¥å¯¹è±¡ç›¸ç­‰å“¦ï¼Œå¯¹è±¡æ°¸ä¸ç›¸ç­‰
				if (this.props.carName === nextProps.carName) {
					return false
				} else {
					return true
				}
			}
//ç»„ä»¶æ›´æ–°å®Œæ¯•çš„é’©å­  è·å–æ—§çš„propså’Œstate
			componentDidUpdate(prevProps, prevState) {
				console.log('componentDidUpdate');
				//componentDidUpdateå¯ä»¥è·å–æ—§çš„å€¼
				console.log(prevProps, prevState)
			}
```

:::

:::tip
å¯¹äº react17:æ‰€æœ‰ will çš„é’©å­éƒ½å¾—åŠ  UNSAFE\_ï¼Œé™¤äº†`componentWillUpdate`</br>
`componentWillMount`å¾—å˜æˆ`UNSAFE_componentWillMount`</br>
`componentWillUpdate`å¾—å˜æˆ`UNSAFE_componentWillUpdate`</br>
`componentWillReceiveProps`å¾—å˜æˆ`UNSAFE_componentWillReceiveProps`</br>
åŸå› æ˜¯:è¿™ä¸‰ä¸ªé’©å­ä½¿ç”¨ä¸å¤šï¼Œä¼šå¯¼è‡´è¯¯ç”¨ï¼Œunsafe ä¸æ˜¯æŒ‡ä¸å®‰å…¨ï¼Œæ˜¯æŒ‡æœªæ¥ç‰ˆæœ¬ä¸­å¯èƒ½å‡ºç° bugï¼Œä¸ºä»¥åé“ºè·¯
:::

### 2.æ–°ç”Ÿå‘½å‘¨æœŸ

ç”±ä¸Šæ–‡ `tips` `å¯çŸ¥ï¼Œreact` å°†è¦åºŸå¼ƒ `componentWillMount` `componentWillUpdate` `componentWillReceiveProps` ï¼Œå¦‚æœä½ é‡‡ç”¨çš„è¯å¾—åœ¨å‰é¢åŠ ä¸Š `UNSAFE_` ,è¿™é‡Œè®²ä¸€ä¸‹åºŸé™¤åå¼•å…¥çš„ 2 ä¸ªæ–°çš„é’©å­ `getDerivedStateFromProps` å’Œ `getSnapshotBeforeUpdate`ã€‚
![æ–°ç”Ÿå‘½å‘¨æœŸ.png](<http://47.99.154.206:8010/reactç”Ÿå‘½å‘¨æœŸ/reactç”Ÿå‘½å‘¨æœŸ(æ–°).png>)

- ç”±å›¾å¯çŸ¥`getDerivedStateFromProps` æ¨ªç©¿æŒ‚è½½å’Œæ›´æ–°ï¼Œæ‰€ä»¥åœ¨ä¸¤ä¸ªè¿‡ç¨‹ä¸­éƒ½ä½¿ç”¨ã€‚

```js
      //ä¸èƒ½å®šä¹‰åœ¨å®ä¾‹ä¸Šï¼Œéœ€è¦å®šä¹‰ä¸ºé™æ€æ–¹æ³•(ä¹Ÿå°±æ˜¯ä¸èƒ½ä¸åŠ static)ï¼Œä½¿ç”¨staticï¼Œå¿…é¡»æœ‰è¿”å›ä¸ºçŠ¶æ€å¯¹è±¡(state Obj)æˆ–è€…null
			//å¯ä»¥å½±å“stateé‡Œçš„å€¼çš„æ›´æ–°ï¼Œä½¿stateé‡Œçš„å€¼ä»¥è¿™é‡Œçš„ä¸ºå‡†ï¼Œå¹¶ä¸”æ— æ³•é€šè¿‡setstateæ”¹å˜
			//ç”¨æ³•ï¼šğŸŒŸè‹¥stateçš„å€¼åœ¨ä»»ä½•æ—¶å€™éƒ½å–å†³äºpropsï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨getDerivedStateFromProps
			//---äº†è§£å³å¯ï¼Œä¼šä½¿å¾—ä»£ç å†—ä½™ï¼Œéš¾ä»¥ç»´æŠ¤ï¼Œå°½é‡ä¸ç”¨
			static getDerivedStateFromProps(props,state){ //å¯ä»¥å–åˆ°propså’Œstate
				console.log('getDerivedStateFromProps',props,state);
				return null
				// return props //å¯ä»¥æŠŠpropså½“æˆstate
			}
```

- `getSnapshotBeforeUpdate`åªåœ¨æ›´æ–°æ—¶è°ƒç”¨

```js
      //éœ€è¦æœ‰è¿”å›å€¼
      //ä¹‹å‰çš„propså’Œä¹‹å‰çš„çŠ¶æ€ï¼Œåœ¨æ›´æ–°ä¹‹å‰è°ƒç”¨ï¼Œè·å–å¿«ç…§ï¼Œè·å–é¡µé¢æ›´æ–°å‰çš„refså€¼ç­‰
		  //å¯ä»¥å°†è¿”å›å€¼ä¼ ç»™didUpdate
			getSnapshotBeforeUpdate(preProps,preState){
				return 'xxx'
			}

			//å·²ç»æ›´æ–°åè°ƒç”¨,å¯ä»¥è·å–ä¹‹å‰çš„propså’Œä¹‹å‰çš„çŠ¶æ€
			componentDidUpdate(preProps,preState,name){
				console.log(name) //'xxx'
			}
```

å¯ä»¥ç”¨æ¥è·å–æ›´æ–°å‰å®šä¹‰çš„ refs ä¸Šçš„å®½é«˜ç­‰

## 2.å—æ§ç»„ä»¶å’Œéå—æ§ç»„ä»¶

### 1.å—æ§ç»„ä»¶

å°±æ˜¯æŠŠè¾“å…¥æ¡†çš„å€¼å­˜å‚¨åˆ°çŠ¶æ€ state ä¸­ï¼Œç„¶åå†ä½¿ç”¨

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>2_å—æ§ç»„ä»¶</title>
  </head>
  <body>
    <!-- å‡†å¤‡å¥½ä¸€ä¸ªâ€œå®¹å™¨â€ -->
    <div id="test"></div>

    <!-- å¼•å…¥reactæ ¸å¿ƒåº“ -->
    <script type="text/javascript" src="../js/react.development.js"></script>
    <!-- å¼•å…¥react-domï¼Œç”¨äºæ”¯æŒreactæ“ä½œDOM -->
    <script
      type="text/javascript"
      src="../js/react-dom.development.js"
    ></script>
    <!-- å¼•å…¥babelï¼Œç”¨äºå°†jsxè½¬ä¸ºjs -->
    <script type="text/javascript" src="../js/babel.min.js"></script>

    <script type="text/babel">
      //åˆ›å»ºç»„ä»¶
      class Login extends React.Component {
        //åˆå§‹åŒ–çŠ¶æ€
        state = {
          username: "", //ç”¨æˆ·å
          password: "", //å¯†ç 
        };

        //ä¿å­˜ç”¨æˆ·ååˆ°çŠ¶æ€ä¸­
        saveUsername = (event) => {
          this.setState({ username: event.target.value });
        };

        //ä¿å­˜å¯†ç åˆ°çŠ¶æ€ä¸­
        savePassword = (event) => {
          this.setState({ password: event.target.value });
        };

        //è¡¨å•æäº¤çš„å›è°ƒ
        handleSubmit = (event) => {
          event.preventDefault(); //é˜»æ­¢è¡¨å•æäº¤
          const { username, password } = this.state;
          alert(`ä½ è¾“å…¥çš„ç”¨æˆ·åæ˜¯ï¼š${username},ä½ è¾“å…¥çš„å¯†ç æ˜¯ï¼š${password}`);
        };

        render() {
          return (
            <form onSubmit={this.handleSubmit}>
              ç”¨æˆ·åï¼š
              <input onChange={this.saveUsername} type="text" name="username" />
              å¯†ç ï¼š
              <input
                onChange={this.savePassword}
                type="password"
                name="password"
              />
              <button>ç™»å½•</button>
            </form>
          );
        }
      }
      //æ¸²æŸ“ç»„ä»¶
      ReactDOM.render(<Login />, document.getElementById("test"));
    </script>
  </body>
</html>
```

### 2.éå—æ§ç»„ä»¶

éå—æ§ç»„ä»¶å°±æ˜¯ä¸æŠŠè¾“å…¥æ¡†çš„å€¼å­˜å‚¨èµ·æ¥ï¼Œè€Œæ˜¯ç­‰è¦ä½¿ç”¨çš„æ—¶å€™å†å»å–

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>1_éå—æ§ç»„ä»¶</title>
  </head>
  <body>
    <!-- å‡†å¤‡å¥½ä¸€ä¸ªâ€œå®¹å™¨â€ -->
    <div id="test"></div>

    <!-- å¼•å…¥reactæ ¸å¿ƒåº“ -->
    <script type="text/javascript" src="../js/react.development.js"></script>
    <!-- å¼•å…¥react-domï¼Œç”¨äºæ”¯æŒreactæ“ä½œDOM -->
    <script
      type="text/javascript"
      src="../js/react-dom.development.js"
    ></script>
    <!-- å¼•å…¥babelï¼Œç”¨äºå°†jsxè½¬ä¸ºjs -->
    <script type="text/javascript" src="../js/babel.min.js"></script>

    <script type="text/babel">
      //åˆ›å»ºç»„ä»¶
      class Login extends React.Component {
        handleSubmit = (event) => {
          event.preventDefault(); //é˜»æ­¢è¡¨å•æäº¤
          const { username, password } = this;
          alert(
            `ä½ è¾“å…¥çš„ç”¨æˆ·åæ˜¯ï¼š${username.value},ä½ è¾“å…¥çš„å¯†ç æ˜¯ï¼š${password.value}`
          );
        };
        render() {
          return (
            <form onSubmit={this.handleSubmit}>
              ç”¨æˆ·åï¼š
              <input
                ref={(c) => (this.username = c)}
                type="text"
                name="username"
              />
              å¯†ç ï¼š
              <input
                ref={(c) => (this.password = c)}
                type="password"
                name="password"
              />
              <button>ç™»å½•</button>
            </form>
          );
        }
      }
      //æ¸²æŸ“ç»„ä»¶
      ReactDOM.render(<Login />, document.getElementById("test"));
    </script>
  </body>
</html>
```

## 3.é«˜é˜¶å‡½æ•°â€”â€”å‡½æ•°æŸ¯é‡ŒåŒ–

- **é«˜é˜¶å‡½æ•°**:å¦‚æœä¸€ä¸ªå‡½æ•°ç¬¦åˆä¸‹é¢ 2 ä¸ªè§„èŒƒä¸­çš„ä»»ä½•ä¸€ä¸ªï¼Œé‚£è¯¥å‡½æ•°å°±æ˜¯é«˜é˜¶å‡½æ•°ã€‚

  - 1.è‹¥ A å‡½æ•°ï¼Œ`æ¥æ”¶çš„å‚æ•°æ˜¯ä¸€ä¸ªå‡½æ•°`ï¼Œé‚£ä¹ˆ A å°±å¯ä»¥ç§°ä¹‹ä¸ºé«˜é˜¶å‡½æ•°ã€‚
  - 2.è‹¥ A å‡½æ•°ï¼Œ`è°ƒç”¨çš„è¿”å›å€¼ä¾ç„¶æ˜¯ä¸€ä¸ªå‡½æ•°`ï¼Œé‚£ä¹ˆ A å°±å¯ä»¥ç§°ä¹‹ä¸ºé«˜é˜¶å‡½æ•°ã€‚å¸¸è§çš„é«˜é˜¶å‡½æ•°æœ‰ï¼šPromiseã€setTimeoutã€arr.map()ç­‰ç­‰

- **å‡½æ•°æŸ¯é‡ŒåŒ–**:é€šè¿‡å‡½æ•°è°ƒç”¨ç»§ç»­è¿”å›å‡½æ•°çš„æ–¹å¼ï¼Œå®ç°å¤šæ¬¡æ¥æ”¶å‚æ•°æœ€åç»Ÿä¸€å¤„ç†çš„å‡½æ•°ç¼–ç å½¢å¼ã€‚</br>

1. ç®€å•è¿ç”¨

```js
function sum(a) {
  return (b) => {
    return (c) => {
      return a + b + c;
    };
  };
}
```

2. å…·ä½“åº”ç”¨:å¯ä»¥é€šè¿‡ä¼ é€’å‚æ•°å½¢å¼è®©å‡½æ•°çŸ¥é“ç»™å“ªä¸ªå€¼èµ‹å€¼

```js
//åˆ›å»ºç»„ä»¶
class Login extends React.Component {
  //åˆå§‹åŒ–çŠ¶æ€
  state = {
    username: "", //ç”¨æˆ·å
    password: "", //å¯†ç 
  };

  //ä¿å­˜è¡¨å•æ•°æ®åˆ°çŠ¶æ€ä¸­
  saveFormData = (dataType) => {
    return (event) => {
      this.setState({ [dataType]: event.target.value });
    };
  };

  //è¡¨å•æäº¤çš„å›è°ƒ
  handleSubmit = (event) => {
    event.preventDefault(); //é˜»æ­¢è¡¨å•æäº¤
    const { username, password } = this.state;
    alert(`ä½ è¾“å…¥çš„ç”¨æˆ·åæ˜¯ï¼š${username},ä½ è¾“å…¥çš„å¯†ç æ˜¯ï¼š${password}`);
  };
  render() {
    return (
      <form onSubmit={this.handleSubmit}>
        ç”¨æˆ·åï¼š
        <input
          onChange={this.saveFormData("username")}
          type="text"
          name="username"
        />
        å¯†ç ï¼š
        <input
          onChange={this.saveFormData("password")}
          type="password"
          name="password"
        />
        <button>ç™»å½•</button>
      </form>
    );
  }
}
```

å…¶å®è¯¥æ–¹æ³•å®Œå…¨ä¹Ÿä¸ç”¨æŸ¯é‡ŒåŒ–å»å®ç°ï¼Œå¯ä»¥é€šè¿‡ç®­å¤´å‡½æ•°ä¼ é€’å‚æ•°ï¼Œæˆ–è€… bind å®ç°

```js
//ä¿å­˜è¡¨å•æ•°æ®åˆ°çŠ¶æ€ä¸­
saveFormData = (dataType,event)=>{
	  this.setState({[dataType]:event.target.value})
}

//æ–¹æ³•1:ç®­å¤´å‡½æ•°
<form onSubmit={this.handleSubmit}>
			ç”¨æˆ·åï¼š<input onChange={event => this.saveFormData('username',event) } type="text" name="username"/>
			å¯†ç ï¼š<input onChange={event => this.saveFormData('password',event) } type="password" name="password"/>
			<button>ç™»å½•</button>
</form>

//æ–¹æ³•2:bind
<form onSubmit={this.handleSubmit}>
			ç”¨æˆ·åï¼š<input onChange={this.saveFormData.bind(this,'username',event) } type="text" name="username"/>
			å¯†ç ï¼š<input onChange={this.saveFormData.bind(this,'password',event) } type="password" name="password"/>
			<button>ç™»å½•</button>
</form>
```

## 4.react-router

### 1.switch çš„ä½¿ç”¨

1. é€šå¸¸æƒ…å†µä¸‹ï¼Œpath å’Œ component æ˜¯ä¸€ä¸€å¯¹åº”çš„å…³ç³»ã€‚
2. Switch å¯ä»¥æé«˜è·¯ç”±åŒ¹é…æ•ˆç‡(å•ä¸€åŒ¹é…)ã€‚

### 3ã€Redirect çš„ä½¿ç”¨

1. ä¸€èˆ¬å†™åœ¨æ‰€æœ‰è·¯ç”±æ³¨å†Œçš„æœ€ä¸‹æ–¹ï¼Œå½“æ‰€æœ‰è·¯ç”±éƒ½æ— æ³•åŒ¹é…æ—¶ï¼Œè·³è½¬åˆ° Redirect æŒ‡å®šçš„è·¯ç”±
2. å…·ä½“ç¼–ç ï¼š

```js
<Switch>
  <Route path="/about" component={About} />
  <Route path="/home" component={Home} />
  <Redirect to="/about" />
</Switch>
```

### 3.æ¨¡ç³ŠåŒ¹é…å’Œ exact ç²¾ç¡®åŒ¹é…

```js
//1.æ¨¡ç³ŠåŒ¹é…
<MyNavLink to="/home/news">Home</MyNavLink>

<Route path='/home/news' component={News} />
<Route  path="/home" component={Home}/>
`MyNavLink`è·¯ç”±è·³è½¬æ—¢èƒ½åŒ¹é…åˆ°`/home`,åˆèƒ½åŒ¹é…åˆ°`/home/news`ï¼Œä¼šå¯¼è‡´å†…å®¹éƒ½å‡ºç°ï¼Œ

//2,ç²¾ç¡®åŒ¹é…
<MyNavLink to="/home/news">Home</MyNavLink>

<Route path='/home/news' exact component={News} />
<Route  path="/home" exact component={Home}/>
`MyNavLink`è·¯ç”±è·³è½¬åªèƒ½åŒ¹é…åˆ°`/home/news`
```

### 4.è·¯ç”±åµŒå¥—

`è·¯ç”±åµŒå¥—`çš„æƒ…å†µä¸‹è¦å…³é—­`ç²¾ç¡®åŒ¹é…`ï¼Œè¿™æ ·æ‰å¯ä»¥ä½¿çˆ¶å­å†…å®¹éƒ½å‡ºç°

### 5.withRouter form 'react-router-dom'

è·¯ç”±åªèƒ½åœ¨è·¯ç”±ç»„ä»¶ä¸­ä½¿ç”¨ï¼Œéè·¯ç”±ç»„ä»¶å¾—ç”¨`withRouter`åŠ å·¥ç»„ä»¶

```js
class Home extends React.Component{
 ...
}
export default withRouter(Home)
```

### 6ã€BrowserRouter ä¸ HashRouter çš„åŒºåˆ«

1. åº•å±‚åŸç†ä¸ä¸€æ ·ï¼š</br>
   BrowserRouter ä½¿ç”¨çš„æ˜¯ H5 çš„ history APIï¼Œä¸å…¼å®¹ IE9 åŠä»¥ä¸‹ç‰ˆæœ¬ã€‚</br>
   HashRouter ä½¿ç”¨çš„æ˜¯ URL çš„å“ˆå¸Œå€¼ã€‚(ä¸ä¼šç»™æœåŠ¡å™¨å‘é€è¯·æ±‚)
2. path è¡¨ç°å½¢å¼ä¸ä¸€æ ·</br>
   BrowserRouter çš„è·¯å¾„ä¸­æ²¡æœ‰#,ä¾‹å¦‚ï¼šlocalhost:3000/demo/test</br>
   HashRouter çš„è·¯å¾„åŒ…å«#,ä¾‹å¦‚ï¼šlocalhost:3000/#/demo/test
3. åˆ·æ–°åå¯¹è·¯ç”± state å‚æ•°çš„å½±å“</br>
   (1).BrowserRouter æ²¡æœ‰ä»»ä½•å½±å“ï¼Œå› ä¸º state ä¿å­˜åœ¨ history å¯¹è±¡ä¸­ã€‚</br>
   (2).HashRouter åˆ·æ–°åä¼šå¯¼è‡´è·¯ç”± state å‚æ•°çš„ä¸¢å¤±ï¼ï¼ï¼</br>
4. å¤‡æ³¨ï¼šHashRouter å¯ä»¥ç”¨äºè§£å†³ä¸€äº›è·¯å¾„é”™è¯¯ç›¸å…³çš„é—®é¢˜ã€‚

## 5.react-redux

### 1.åŸºç¡€ç‰ˆæœ¬

1. å¼•å…¥åˆ›å»º`store`çš„`createStore`å’Œåˆå¹¶`store`çš„`combineReducers`,åˆ›å»ºå¹¶åˆå¹¶`store`ï¼Œæœ€åå¯¼å‡º

```js
//åˆ›å»ºreducer
const count = function(state = { count: 11 }, action) {
  switch (action.type) {
    case "COUNT_ADD":
      return {
        count: state.count + action.value,
      };
    case "COUNT_REDUCE":
      return {
        count: state.count - action.value,
      };
    default:
      return {
        ...state,
      };
  }
};
//åˆå¹¶reducer
const rootReducer = combineReducers({
  count,
});
//åˆ›å»ºä»¥reducerä¸ºå‚æ•°çš„store
const store =createStore(rootReducer)
export {store}
```

### 2.å«åŒå¼‚æ­¥actionå¹¶ä½¿ç”¨
- ç”±äº`redux`ä½¿ç”¨çš„å¹¿æ³›ï¼Œreactå®˜ç½‘æ¨å‡ºäº†`react-redux`,`react-redux`ä¸éœ€è¦åƒä¸‹æ–¹ä¸€æ ·ç›‘æµ‹å˜åŒ–æ›´æ–°
```js
//ç›‘æµ‹reduxä¸­çŠ¶æ€çš„æ”¹å˜ï¼Œå¦‚reduxçš„çŠ¶æ€å‘ç”Ÿäº†æ”¹å˜ï¼Œé‚£ä¹ˆé‡æ–°æ¸²æŸ“Appç»„ä»¶
import { store } from "./redux/store";
store.subscribe(()=>{
	ReactDOM.render(<App/>,document.getElementById('root'))
})
```

> `react-redux` é‡‡ç”¨`connent`apiå°†`å®¹å™¨ç»„ä»¶`å’Œ`uiç»„ä»¶`ä¸²è”èµ·æ¥ï¼Œå°†`store`ä¼ å…¥å®¹å™¨ç»„ä»¶ï¼Œå¹¶é€šè¿‡propsçš„æ–¹å¼å°† `store` é‡Œçš„ `state` å’Œ `action` ä¼ é€’ç»™ `uiç»„ä»¶`
```js
//app.jsx
import { store } from "./redux/store";
<Count store={store}/>

//count.jsx
import {connect} from 'react-redux'
export default connect(
   state=>({key:state}),
   dispatch=>({
     fnc1:(value)=>dispatch(action1(value)),
     fnc2:(value)=>dispatch(action2(value))
   })
   //ç®€å†™,ä¸éœ€è¦å†™å‚æ•°å’Œdispatchï¼Œå‚æ•°åœ¨actionä¸­ä¼šæœ‰ï¼Œreact-reduxä¼šè‡ªåŠ¨åˆ†å‘dispatch
   {
     fn1:action1
   }
)(Count) //ä¸²è”uiç»„ä»¶
```

:::tip
åŒæ­¥`aciton`çš„å€¼ä¸ºä¸€èˆ¬å¯¹è±¡{type,value} è€Œå¼‚æ­¥`action`çš„å€¼ä¸º`å‡½æ•°`ï¼Œå¼•å…¥`redux-thunk`ï¼Œç”¨äºæ”¯æŒ`å¼‚æ­¥action`è¿”å›å€¼ä¸º`å‡½æ•°`
:::
> å¼‚æ­¥actionå®ç°
```js
//action.js
export const creatCountAdd =(value)=>({type:'COUNT_ADD',value})
//åŒæ­¥acitonçš„å€¼ä¸ºä¸€èˆ¬å¯¹è±¡{type,value}
export const creatCountReduce =(value)=>({type:'COUNT_REDUCE',value})
//è€Œå¼‚æ­¥actionçš„å€¼ä¸ºå‡½æ•°ï¼Œ //å¼•å…¥redux-thunkï¼Œç”¨äºæ”¯æŒå¼‚æ­¥actionè¿”å›å€¼ä¸ºå‡½æ•°
export const AsynccreatCountAdd=(data)=>{
    return (dispatch)=>{
		new Promise((resolve,reject)=>{
            dispatch(creatCountAdd(data))
            resolve()
        })
	}
    // return (dispatch)=>{
    //     setTimeout(()=>{
	// 		dispatch(creatCountAdd(data))
	// 	},time)
    // }
}

//store.js
import {createStore,combineReducers,applyMiddleware} from 'redux'
//å¼•å…¥redux-thunkï¼Œç”¨äºæ”¯æŒå¼‚æ­¥action
const store =createStore(rootReducer,applyMiddleware(thunk))
```


### ä½¿ç”¨pushæˆ–è€…unshiftæ›´æ”¹stateä¸æ›´æ–°é¡µé¢åŸå› 
åœ¨ä½¿ç”¨`push`ï¼Œ`unshift`è¿›è¡Œæ·»åŠ storeæ•°æ®çš„æ—¶å€™ï¼Œé¡µé¢ä¸ä¼šè¿›è¡Œæ›´æ–°
```js
const count = function(state = [{name:'1'}], action) {
  switch (action.type) {
    case "COUNT_ADD":
      state.push({name:'2'})
      return state
    default:
      return {
        ...state,
      };
  }
};
```
- reduxçš„reducerå‡½æ•°å¿…é¡»æ˜¯ä¸€ä¸ªçº¯å‡½æ•°
- ä¸Šæ–¹ä¾‹å­ä¼šå¯¼è‡´é¡µé¢ä¸æ›´æ–°ï¼ŒåŸå› æ˜¯reduxåˆ¤æ–­æ›´æ–°æ˜¯ç”¨çš„æµ…æ¯”è¾ƒï¼Œä¹Ÿå°±æ˜¯stateçš„`åœ°å€å€¼`æ¯”è¾ƒ,`push`å’Œ`unshift`å¹¶ä¸ä¼šæ”¹å˜state`åœ°å€å€¼`
- ä¸Šæ–¹ä¾‹å­é€šè¿‡`push`å’Œ`unshift`æ”¹å˜äº†å‚æ•°ï¼Œå°±ä¸æ˜¯çº¯å‡½æ•°äº†
> è§£å†³æ–¹æ¡ˆ:è¿”å›å€¼ä½¿ç”¨æ•°ç»„:`[...state]`,å¯¹è±¡`...state`


:::tip
**çº¯å‡½æ•°**
1. ä¸€ç±»ç‰¹åˆ«çš„å‡½æ•°: åªè¦æ˜¯åŒæ ·çš„è¾“å…¥(å®å‚)ï¼Œå¿…å®šå¾—åˆ°åŒæ ·çš„è¾“å‡º(è¿”å›)
2. + å¿…é¡»éµå®ˆä»¥ä¸‹ä¸€äº›çº¦æŸÂ Â 
     - 1)ä¸å¾—æ”¹å†™å‚æ•°æ•°æ®
     - 2)ä¸ä¼šäº§ç”Ÿä»»ä½•å‰¯ä½œç”¨ï¼Œä¾‹å¦‚ç½‘ç»œè¯·æ±‚ï¼Œè¾“å…¥å’Œè¾“å‡ºè®¾å¤‡
     - 3)ä¸èƒ½è°ƒç”¨Date.now()æˆ–è€…Math.random()ç­‰ä¸çº¯çš„æ–¹æ³•Â Â 
3. reduxçš„reducerå‡½æ•°å¿…é¡»æ˜¯ä¸€ä¸ªçº¯å‡½æ•°
:::