---
title: 16.react-ä¸å¸¸ç”¨hooks
sidebar: auto
date: 2021-09-27 00:00:00
tags:
categories:
  - reactç›¸å…³å­¦ä¹ 
---


å¸¸ç”¨`hooks`æœ‰`useState`,`useEffect`,`useMemo`,`useRef`,æ¥ä¸‹æ¥è¯¦ç»†è§£æä¸å¸¸ç”¨**hooks**:`useReducer`

## useReducer
ä¸ªäººç†è§£ç›¸å½“äº`useState`,åªæ˜¯ä»–çš„æ”¹å˜æ–¹æ³•å¯ä»¥æœ‰å¤šç§
```js
//demo
import {useReducer} from 'react';

const SHooks=()=>{ 
     // ç¬¬ä¸€ä¸ªå‚æ•°ï¼šåº”ç”¨çš„åˆå§‹åŒ–
    const initialState = {count: 0};

    // ç¬¬äºŒä¸ªå‚æ•°ï¼šstateçš„reducerå¤„ç†å‡½æ•°
    function reducer(state, action) {
        switch (action.type) {
            case 'increment':
              return {count: state.count + action.value};
            case 'decrement':
               return {count: state.count - 1};
            default:
                throw new Error();
        }
    }
    const [state, dispatch] = useReducer(reducer, initialState);
  
   return(
       <div>{state.count}
         <h1 onClick={()=>dispatch({type:'increment',value:3})}>åŠ åŠ </h1>
       </div>
   )
}


export default SHooks
```



## useCallback
é…åˆ`memo`ä½¿ç”¨ï¼Œæ¥ä½¿å­ç»„ä»¶äº‹ä»¶çš„å€¼å˜åŒ–å†é‡æ–°`render`
```js
import React, { useState, useCallback, memo } from 'react'
/**
 * useCallbackåœ¨ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ï¼Ÿ
 * åœºæ™¯ï¼šåœ¨å°†ä¸€ä¸ªç»„ä»¶ä¸­çš„å‡½æ•°ï¼Œä¼ é€’ç»™å­å…ƒç´ è¿›è¡Œå›è°ƒä½¿ç”¨æ—¶ï¼Œ
 * ä½¿ç”¨useCallbackå¯¹å‡½æ•°è¿›è¡Œå¤„ç†ã€‚
 * 
 */
const HYButton = memo((props) => {
  console.log("HYButtoné‡æ–°æ¸²æŸ“ï¼š" + props.title);
  return <button onClick={props.increment}>HYButton +1</button>
})
export default function CallbackHookDemo02() {
  console.log("CallbackHookDemo02é‡æ–°æ¸²æŸ“");
  const [count, setCount] = useState(0);
  const [show, setShow] = useState(true);
  const increment1 = () => {
    console.log("æ‰§è¡Œincrement1å‡½æ•°");
    setCount(count + 1);
  }
  const increment2 = useCallback(() => {
    console.log("æ‰§è¡Œincrement2å‡½æ•°");
    setCount(count + 1);
  }, [count])  //ğŸŒŸğŸŒŸè¿™é‡Œä½¿ç”¨useCallbackä½¿å¾—è°ƒç”¨ increment2 å‡½æ•°åä¼šå†å»åˆ¤æ–­ count æœ‰æ— æ›´æ–°æ¥æ›´æ–°å­ç»„ä»¶
  return (
    <div>
      <h2>CallbackHookDemo01ï¼š{count}</h2>
      {/* <button onClick={increment1}>+1</button>
      <button onClick={increment2}>+1</button> */}
      <HYButton title="btn1" increment={increment1} />
      <HYButton title="btn2" increment={increment2} />
      <button onClick={e => setShow(!show)}>showåˆ‡æ¢</button>
    </div>
  )
}
```


## useLayoutEffect
useLayoutEffectçœ‹èµ·æ¥å’ŒuseEffectéå¸¸çš„ç›¸ä¼¼,äº‹å®ä¸Šä»–ä»¬ä¹Ÿåªæœ‰ä¸€ç‚¹`åŒºåˆ«`è€Œå·²ï¼Œå°±æ˜¯
```
1. useEffectä¼šåœ¨æ¸²æŸ“çš„å†…å®¹æ›´æ–°åˆ°DOMä¸Šåæ‰§è¡Œ,ä¸ä¼šé˜»å¡DOMçš„æ›´æ–°(useEffectåœ¨æµè§ˆå™¨æ¸²æŸ“å®Œæˆåæ‰§è¡Œ)
2. useLayoutEffectä¼šåœ¨æ¸²æŸ“çš„å†…å®¹æ›´æ–°åˆ°DOMä¸Šä¹‹å‰è¿›è¡Œ,ä¼šé˜»å¡DOMçš„æ›´æ–°(useLayoutEffectåœ¨æµè§ˆå™¨æ¸²æŸ“å‰æ‰§è¡Œ
)
```

`ç‰¹ç‚¹`ï¼š
```
useLayoutEffectæ€»æ˜¯æ¯”useEffectå…ˆæ‰§è¡Œ
useLayoutEffecté‡Œé¢çš„ä»»åŠ¡æœ€å¥½å½±å“äº†Layoutï¼ˆå¸ƒå±€ï¼‰
```


## useImperativeHandle(è‡ªå®šä¹‰æš´éœ²ç»™çˆ¶ç»„ä»¶çš„å®ä¾‹)
### å›é¡¾ä¸€ä¸‹refå’ŒforwardRefç»“åˆä½¿ç”¨ï¼š

1. é€šè¿‡forwardRefå¯ä»¥å°†refè½¬å‘åˆ°å­ç»„ä»¶ï¼›
2. å­ç»„ä»¶æ‹¿åˆ°çˆ¶ç»„ä»¶ä¸­åˆ›å»ºçš„refï¼Œç»‘å®šåˆ°è‡ªå·±çš„æŸä¸€ä¸ªå…ƒç´ ä¸­ã€‚
```js
import React, { useRef, forwardRef } from 'react'
const HYInput = forwardRef((props, ref) => {
  return <input ref={ref} type="text" />
})
export default function ForwardRefDemo() {
  const inputRef = useRef();
  return (
    <div>
      <HYInput ref={inputRef} />
      <button onClick={e => inputRef.current.focus()}>èšç„¦</button>
    </div>
  )
}
```

### useImperativeHandle:è‡ªå®šä¹‰æš´éœ²å‡ºå»çš„å®ä¾‹
```js
import React, { useRef, useImperativeHandle,forwardRef} from 'react';

//å­ç»„ä»¶
const HYInput = forwardRef((props, ref) => {
    // inputRefåœ¨æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­åº”è¯¥æ˜¯ä¸å˜çš„
    const childRef = useRef();
    useImperativeHandle(ref, () => ({
        //å®šä¹‰valueä¸ºchildRef.current
      value:childRef.current
    }), [childRef.current]);
    return <input ref={childRef} type="text" />
  })

//çˆ¶ç»„ä»¶
const SHooks = props => {
    const inputRef = useRef();
    return (
      <div>
        <HYInput ref={inputRef} />
        {/* è¿™é‡ŒinputRef.currentå–åˆ°å­ç»„ä»¶å®šä¹‰çš„value*/}
        <button onClick={e => console.dir(inputRef.current)}>èšç„¦</button>
      </div>
    )
}
// console.dirçš„ç»“æœä¸ºå­ç»„ä»¶ä¸­çš„:value:childRef.current
export default SHooks
```
