---
title: 03.webpackç”Ÿäº§ç¯å¢ƒé…ç½®
sidebar: auto
date: 2021-08-23 00:00:00
tags:
  - webpckç”Ÿäº§ç¯å¢ƒé…ç½®
categories:
  - å‰ç«¯æ„å»ºå·¥å…·
---

# ç”Ÿäº§ç¯å¢ƒé…ç½®æ‰€éœ€ä¾èµ–

## 1. æå– css æˆå•ç‹¬æ–‡ä»¶

```js
const MiniCssExtractPlugin = require("mini-css-extract-plugin");
module.exports = {
  module: {
    rules: [
      {
        test: /\.css$/,
        use: [
          // åˆ›å»ºstyleæ ‡ç­¾ï¼Œå°†æ ·å¼æ”¾å…¥
          // 'style-loader',
          // è¿™ä¸ªloaderå–ä»£style-loaderã€‚ä½œç”¨ï¼šæå–jsä¸­çš„cssæˆå•ç‹¬æ–‡ä»¶
          MiniCssExtractPlugin.loader,
          // å°†cssæ–‡ä»¶æ•´åˆåˆ°jsæ–‡ä»¶ä¸­
          "css-loader",
        ],
      },
    ],
  },
};
```

## 2. css å…¼å®¹æ€§å¤„ç† `postcss-loader`,`postcss-preset-env`

```js
// è®¾ç½®nodejsç¯å¢ƒå˜é‡
process.env.NODE_ENV = "development";
module.exports = {
  module: {
    rules: [
      {
        test: /\.css$/,
        use: [
          MiniCssExtractPlugin.loader,
          "css-loader",
          /*
            csså…¼å®¹æ€§å¤„ç†ï¼špostcss --> postcss-loader postcss-preset-env

            (postcss-preset-env)å¸®postcssæ‰¾åˆ°package.jsonä¸­browserslisté‡Œé¢çš„é…ç½®ï¼Œé€šè¿‡é…ç½®åŠ è½½æŒ‡å®šçš„csså…¼å®¹æ€§æ ·å¼
              ğŸ(last 1 chrome version:å…¼å®¹æœ€è¿‘çš„ä¸€ä¸ªchremeç‰ˆæœ¬)
              (>0.2%:å¤§äºç™¾åˆ†ä¹‹99.8çš„æµè§ˆå™¨ï¼Œnot deadä¸è¦æ­»çš„ï¼Œnot op_mini allä¸è¦op_miniæ‰€æœ‰çš„ï¼Œéƒ½æ­»å®Œäº†)
            "browserslist": {
              // å¼€å‘ç¯å¢ƒ --> è®¾ç½®nodeç¯å¢ƒå˜é‡ï¼šprocess.env.NODE_ENV = development
              "development": [
                "last 1 chrome version",
                "last 1 firefox version",
                "last 1 safari version"
              ],
              // ç”Ÿäº§ç¯å¢ƒï¼šé»˜è®¤æ˜¯çœ‹ç”Ÿäº§ç¯å¢ƒ
              "production": [
                ">0.2%",
                "not dead",
                "not op_mini all"
              ]
            }
          */
          // ä½¿ç”¨loaderçš„é»˜è®¤é…ç½®
          // 'postcss-loader',
          // ä¿®æ”¹loaderçš„é…ç½®
          {
            loader: "postcss-loader",
            options: {
              ident: "postcss",
              plugins: () => [
                // postcssçš„æ’ä»¶
                require("postcss-preset-env")(),
              ],
            },
          },
        ],
      },
    ],
  },
};
```

## 3. å‹ç¼© css

```js
const OptimizeCssAssetsWebpackPlugin = require("optimize-css-assets-webpack-plugin");
module.exports = {
  plugins: [
    // å‹ç¼©css
    new OptimizeCssAssetsWebpackPlugin(),
  ],
};
```

## 4. js è¯­æ³•æ£€æŸ¥

```js
module.exports = {
  module: {
    rules: [
      /*
        è¯­æ³•æ£€æŸ¥ï¼š eslint-loader  eslint
          æ³¨æ„ï¼šåªæ£€æŸ¥è‡ªå·±å†™çš„æºä»£ç ï¼Œç¬¬ä¸‰æ–¹çš„åº“æ˜¯ä¸ç”¨æ£€æŸ¥çš„
          è®¾ç½®æ£€æŸ¥è§„åˆ™ï¼š
            package.jsonä¸­eslintConfigä¸­è®¾ç½®~æ¨èä½¿ç”¨airbnb-base
              "eslintConfig": {
                "extends": "airbnb-base"
              }
            airbnb --> eslint-config-airbnb-base  eslint-plugin-import eslint  eslint-loader 
            reactçš„è¯-->eslint-config-airbnb  eslint-plugin-import eslint   eslint-loader 
      */
      {
        test: /\.js$/,
        //æ’é™¤node_modules
        exclude: /node_modules/,
        loader: "eslint-loader",
        options: {
          // è‡ªåŠ¨ä¿®å¤eslintçš„é”™è¯¯
          fix: true,
        },
      },
    ],
  },
};
```

## 5.js å…¼å®¹æ€§å¤„ç† 
`babel-loader`,`@babel/core`,`@babel/preset-env`,`core-js`
```js
module.exports = {
  module: {
    rules: [
      /*
        jså…¼å®¹æ€§å¤„ç†ï¼šbabel-loader @babel/core 
          1. åŸºæœ¬jså…¼å®¹æ€§å¤„ç† --> @babel/preset-env
            é—®é¢˜ï¼šåªèƒ½è½¬æ¢åŸºæœ¬è¯­æ³•ï¼Œå¦‚promiseé«˜çº§è¯­æ³•ä¸èƒ½è½¬æ¢
          2. å…¨éƒ¨jså…¼å®¹æ€§å¤„ç† --> @babel/polyfill   (è¿™ä¸ªåªéœ€è¦å¼•å…¥å°±å¥½äº†// import '@babel/polyfill';)
            é—®é¢˜ï¼šæˆ‘åªè¦è§£å†³éƒ¨åˆ†å…¼å®¹æ€§é—®é¢˜ï¼Œä½†æ˜¯å°†æ‰€æœ‰å…¼å®¹æ€§ä»£ç å…¨éƒ¨å¼•å…¥ï¼ŒğŸŒŸä½“ç§¯å¤ªå¤§äº†~
          3. éœ€è¦åšå…¼å®¹æ€§å¤„ç†çš„å°±åšï¼šæŒ‰éœ€åŠ è½½  --> core-js (æœ€å¥½çš„æ–¹æ¡ˆï¼Œä½“ç§¯ä¸å¤§)
      */

      {
        test: /\.js$/,
        exclude: /node_modules/,
        loader: "babel-loader",
        options: {
          // é¢„è®¾ï¼šæŒ‡ç¤ºbabelåšæ€ä¹ˆæ ·çš„å…¼å®¹æ€§å¤„ç†
          presets: [
            [
              "@babel/preset-env",
              {
                // æŒ‰éœ€åŠ è½½
                useBuiltIns: "usage",
                // æŒ‡å®šcore-jsç‰ˆæœ¬
                corejs: {
                  version: 3,
                },
                // æŒ‡å®šå…¼å®¹æ€§åšåˆ°å“ªä¸ªç‰ˆæœ¬æµè§ˆå™¨
                targets: {
                  chrome: "60",
                  firefox: "60",
                  ie: "9",
                  safari: "10",
                  edge: "17",
                },
              },
            ],
          ],
        },
      },
    ],
  },
};
```

## 6.jså‹ç¼©å–htmlå‹ç¼©
```js
const { resolve } = require('path');
const HtmlWebpackPlugin = require('html-webpack-plugin');

module.exports = {
  entry: './src/js/index.js',
  output: {
    filename: 'js/built.js',
    path: resolve(__dirname, 'build')
  },
  plugins: [
      //htmlå‹ç¼©
    new HtmlWebpackPlugin({
      template: './src/index.html',
      // å‹ç¼©htmlä»£ç 
      minify: {
        // ç§»é™¤ç©ºæ ¼
        collapseWhitespace: true,
        // ç§»é™¤æ³¨é‡Š
        removeComments: true
      }
    })
  ],
  //ç”Ÿäº§ç¯å¢ƒä¼šè‡ªåŠ¨jså‹ç¼©
  mode: 'production'
};

```